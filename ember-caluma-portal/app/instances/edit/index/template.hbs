<div class="uk-grid-collapse" uk-grid>
  <div class="uk-width-1-3">
    <h2 class="instance-overview__title">
      {{t "instances.masterData"}}
    </h2>
  </div>
  <div class="uk-width-2-3">
    <table
      class="uk-table uk-table-justify uk-table-small instance-overview__info-table"
    >
      <tbody>
        <tr>
          <th class="uk-text-bold uk-width-1-6 uk-text-top">
            {{t (concat "instances.special-id-" (application-name))}}
          </th>
          <td class="uk-width-1-3">
            {{or this.data.ebauNr "-"}}
          </td>
          <th class="uk-text-bold uk-width-1-6">
            {{t (concat "instances.address-" (application-name))}}
          </th>
          <td class="uk-width-1-3">
            {{or this.data.address "-"}}
          </td>
        </tr>
        <tr>
          <th class="uk-text-bold uk-width-1-6">
            {{t "instances.type"}}
          </th>
          <td class="uk-width-1-3">
            {{this.data.type}}
          </td>
          <th class="uk-text-bold uk-width-1-6">
            {{t "instances.municipality"}}
          </th>
          <td class="uk-width-1-3">
            {{or this.data.municipality "-"}}
          </td>
        </tr>
        <tr>
          <th class="uk-text-bold uk-width-1-6 uk-text-top">
            {{t "instances.status.title"}}
          </th>
          <td class="uk-width-1-3">
            {{this.instance.status}}
          </td>
          {{#if this.instance.activeService.name}}
            <th class="uk-text-bold uk-width-1-6">
              {{t "instances.lead"}}
            </th>
            <td class="uk-width-1-3">
              {{or this.instance.activeService.name "-"}}
            </td>
          {{else}}
            <th class="uk-text-bold">
              {{t (concat "instances.building-specification-" (application-name))}}
            </th>
            <td>
              {{or this.data.buildingSpecification "-"}}
            </td>
          {{/if}}
        </tr>
        <tr>
          {{! TODO: Druckansicht }}
          <td></td>
          <td></td>
          {{#if this.instance.activeService.name}}
            <th class="uk-text-bold">
              {{t (concat "instances.building-specification-" (application-name))}}
            </th>
            <td>
              {{or this.data.buildingSpecification "-"}}
            </td>
          {{/if}}
        </tr>
      </tbody>
    </table>
  </div>
</div>

<hr />

{{#if this.isRejection}}
  <div class="uk-grid-collapse" uk-grid>
    <div class="uk-width-1-3">
      <h2 class="instance-overview__title">
        {{t "instances.reasonForRejection"}}
      </h2>
    </div>
    <div class="uk-width-2-3">
      <div class="uk-alert-danger" uk-alert>
        <p class="white-space-pre-line">
          {{~this.instance.rejectionFeedback~}}
        </p>
      </div>
    </div>
  </div>

  <hr />
{{/if}}

<div class="uk-grid-collapse" uk-grid>
  <div class="uk-width-1-3">
    <h2 class="instance-overview__title">
      {{t "instances.actions"}}
    </h2>
  </div>
  <div class="uk-width-2-3">
    {{#if (can "create copy of instance" this.instance)}}
      <h3 class="instance-overview__action-title">
        {{t "instances.rejectionTitle"}}
      </h3>
      <p>
        {{t "instances.rejectionText"}}
      </p>
      <UkButton
        @on-click={{perform this.createCopy}}
        @disabled={{this.createCopy.isRunning}}
        @loading={{this.createCopy.isRunning}}
      >
        {{t "instances.rejectionTitle"}}
      </UkButton>
    {{/if}}

    {{#if (can "create modification of instance" this.instance)}}
      <h3 class="instance-overview__action-title">
        {{t "instances.modificationTitle"}}
      </h3>
      <p>
        {{t "instances.modificationText"}}
      </p>
      <UkButton
        @on-click={{perform this.createModification}}
        @disabled={{this.createModification.isRunning}}
        @loading={{this.createModification.isRunning}}
      >
        {{t "instances.modificationTitle"}}
      </UkButton>
    {{/if}}

    {{#if (can "write form of instance" this.instance form=(hash slug="main"))}}
      <h3 class="instance-overview__action-title">
        {{t "instances.furtherProcessingOfForm"}}
      </h3>
      <p>
        {{t "instances.furtherProcessingOfFormText"}}
      </p>
      <LinkTo
        @route="instances.edit.form"
        @model={{this.instance.mainForm.slug}}
        class="uk-button uk-button-default"
      >
        {{t "instances.processingOfForm"}}
      </LinkTo>
    {{/if}}

    {{#if (can "write form of instance" this.instance form=(hash slug="sb1"))}}
      <h3 class="instance-overview__action-title">
        {{t "instances.processingOfFormSb1"}}
      </h3>
      <p>
        {{t "instances.processingOfFormSb1Text"}}
      </p>
      <LinkTo
        @route="instances.edit.form"
        @model="sb1"
        class="uk-button uk-button-default"
      >
        {{t "instances.processingOfFormSb1"}}
      </LinkTo>
    {{/if}}

    {{#if (can "write form of instance" this.instance form=(hash slug="sb2"))}}
      <h3 class="instance-overview__action-title">
        {{t "instances.processingOfFormSb2"}}
      </h3>
      <p>
        {{t "instances.processingOfFormSb2Text"}}
      </p>
      <LinkTo
        @route="instances.edit.form"
        @model="sb2"
        class="uk-button uk-button-default"
      >
        {{t "instances.processingOfFormSb2"}}
      </LinkTo>
    {{/if}}

    {{#if (can "extend validity of instance" this.instance)}}
      <h3 class="instance-overview__action-title">
        {{t "instances.extensionPeriodOfValidityTitle"}}
      </h3>
      <p>
        {{t "instances.extensionPeriodOfValidityText"}}
      </p>
      <UkButton
        @label={{t "instances.extensionPeriodOfValidityButton"}}
        @on-click={{perform this.createNewFormExtensionPeriodOfValidity}}
      />
    {{/if}}

    <h3 class="instance-overview__action-title">
      {{t "instances.activateFurtherPersons"}}
    </h3>
    <p>
      {{t "instances.activateFurtherPersonsText"}}
    </p>
    <LinkTo
      @route="instances.edit.applicants"
      class="uk-button uk-button-default"
    >
      {{t "instances.managePermissions"}}
    </LinkTo>

    {{#if (can "delete instance" this.instance)}}
      <h3 class="instance-overview__action-title">
        {{t "instances.deleteInstance"}}
      </h3>
      <p>
        {{t "instances.deleteInstanceText"}}
      </p>
      <UkButton
        @on-click={{perform this.deleteInstance this.instance}}
        @disabled={{this.deleteInstance.isRunning}}
        @loading={{this.deleteInstance.isRunning}}
      >
        {{t "instances.deleteInstance"}}
      </UkButton>
    {{/if}}
  </div>
</div>

{{#if this.hasFeedbackSection}}
  <hr />

  <div class="uk-grid-collapse" uk-grid>
    <div class="uk-width-1-3">
      <h2 class="instance-overview__title">
        {{t "nav.feedback"}}
        {{#if this.feedback}}
          <UkBadge
            @label={{this.feedback.length}}
            class="uk-margin-small-left"
          />
        {{/if}}
      </h2>
    </div>
    <div class="uk-width-2-3">
      {{#if this.feedback}}
        <BeAttachmentList
          @loading={{this.feedbackLoading}}
          @attachments={{this.feedback}}
        />
      {{else}}
        <p>
          {{t "feedback.info"}}
        </p>
      {{/if}}
    </div>
  </div>
{{/if}}

{{#if this.decision}}
  <hr />

  <div class="uk-grid-collapse" uk-grid>
    <div class="uk-width-1-3">
      <h2 class="instance-overview__title">
        {{t "nav.decision"}}
        {{#if this.decision}}
          <UkBadge
            @label={{this.decision.length}}
            class="uk-margin-small-left"
          />
        {{/if}}
      </h2>
    </div>
    <div class="uk-width-2-3">
      <BeAttachmentList
        @loading={{this.decisionLoading}}
        @attachments={{this.decision}}
      />
    </div>
  </div>
{{/if}}