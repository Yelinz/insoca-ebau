<h1 class="uk-flex uk-flex-between">
  {{t "instances.title"}}
  <span>
    {{#link-to "instances.new" class="uk-button uk-button-secondary"}}{{t "instances.new"}}{{/link-to}}
  </span>
</h1>

<form onsubmit={{perform applyFilters}}>
  <div uk-grid class="uk-grid-small uk-margin uk-child-width-1-1 uk-child-width-1-3@l">
    <div>
      <label class="uk-form-label">{{t "instances.type"}}</label>
      <div class="uk-form-controls">
        <select class="uk-select" name="type">
          <option></option>
          {{#each getRootForms.lastSuccessful.value as |form|}}
            <option value={{form.slug}} selected={{eq type form.slug}}>{{form.name}}</option>
          {{/each}}
        </select>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.instanceId"}}</label>
      <div class="uk-form-controls">
        <input type="text" class="uk-input" name="instanceId" value={{instanceId}}>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.ebau"}}</label>
      <div class="uk-form-controls">
        <input type="text" class="uk-input" name="ebau" value={{ebau}}>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.parcel"}}</label>
      <div class="uk-form-controls">
        <input type="text" class="uk-input" name="parcel" value={{parcel}}>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.submitDate"}}</label>
      <div class="uk-form-controls uk-grid-small uk-child-width-1-2" uk-grid>
        <div>
          {{pikaday-input class="uk-input" name="submitFrom" value=submitFrom useUTC=true}}
        </div>
        <div>
          {{pikaday-input class="uk-input" name="submitTo" value=submitTo useUTC=true}}
        </div>
      </div>
    </div>
    <div class="uk-flex uk-flex-right uk-flex-bottom">
      {{uk-button color="default" type="reset" disabled=fetchData.isRunning label=(t "instances.reset") on-click=(perform resetFilters) class="uk-margin-small-right"}}
      {{uk-button color="primary" type="submit" disabled=fetchData.isRunning label=(t "instances.filter")}}
    </div>
  </div>
</form>

<hr>

{{#if (and fetchData.isRunning (eq cases.length 0))}}
  {{#uk-flex horizontal="center" class="uk-padding uk-animation-fade"}}
    {{uk-spinner ratio=3}}
  {{/uk-flex}}
{{else if cases.length}}
  <div class="uk-text-meta">
    {{t "instances.pageInfo" length=cases.length total=pageInfo.totalCount htmlSafe=true}}
  </div>
  <table class="uk-table uk-table-striped uk-table-hover uk-table-responsive">
    <thead>
      <tr>
        <th class="uk-text-nowrap">{{t "instances.instanceId"}}</th>
        <th class="uk-text-nowrap">{{t "instances.ebau"}}</th>
        <th class="uk-text-nowrap">{{t "instances.type"}}</th>
        <th class="uk-text-nowrap">{{t "instances.municipality"}}</th>
        <th class="uk-text-nowrap">{{t "instances.address"}}</th>
        <th class="uk-text-nowrap">{{t "instances.submitDate"}}</th>
        <th class="uk-text-nowrap">{{t "instances.status.title"}}</th>
        <th class="uk-text-nowrap">{{t "instances.description"}}</th>
      </tr>
    </thead>
    <tbody>
      {{#each cases as |case|}}
        <tr>
          <td>
            {{#link-to "instances.edit" case.id title="Klicken Sie um das Gesuch zu bearbeiten"}}
              {{case.id}}
            {{/link-to}}
          </td>
          <td>{{case.ebau}}</td>
          <td class="uk-text-nowrap">{{case.type}}</td>
          <td>{{case.municipality}}</td>
          <td class="uk-text-truncate" title={{case.address}}>{{case.address}}</td>
          <td>{{if case.submitDate (moment-format case.submitDate "DD.MM.YYYY")}}</td>
          <td>{{t (concat "instances.status." case.status)}}</td>
          <td class="uk-text-truncate" title={{case.description}}>{{case.description}}</td>
        </tr>
      {{/each}}
      {{#if pageInfo.hasNextPage}}
        <tr>
          <td colspan="8" class="uk-text-center">
            {{#in-viewport onEnter=(perform fetchData pageInfo.endCursor)}}
              {{uk-spinner}}
            {{/in-viewport}}
          </td>
        </tr>
      {{/if}}
    </tbody>
  </table>
{{else}}
  {{#uk-flex horizontal="center" vertical="middle" direction="column"}}
    <div class="uk-text-center uk-width-large">
      <object data="/assets/images/stamp-document.svg" class="uk-width-medium"></object>
      <h4 class="uk-margin-remove-top">{{t "instances.emptyTitle"}}</h4>
      <p>{{t "instances.emptyText"}}</p>
      {{#link-to "instances.new" class="uk-button uk-button-primary uk-button-large"}}{{t "instances.new"}}{{/link-to}}
    </div>
  {{/uk-flex}}
{{/if}}