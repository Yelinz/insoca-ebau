{{#if data.lastSuccessful}}
  {{#if (or identifier data.lastSuccessful.value data.isRunning)}}
    <h1>Meine Dossiers</h1>

    <div class="uk-search uk-search-default uk-width-1-1 uk-hidden@m">
      <span uk-search-icon></span>
      <input class="uk-search-input" type="search" placeholder="Gesuchsnummer suchen..." value={{identifier}} oninput={{action (perform search) value="target.value"}}>
    </div>

    <table class="uk-table uk-table-striped uk-table-hover uk-table-responsive">
      <thead>
        <tr>
          <th class="uk-width-1-5">
            <div class="uk-flex-inline uk-width-1-1 uk-flex-between" data-toggle-search="identifier-search">
              <span>
                eBau-Nr.
                {{camac-sort-icon key="identifier" sort=sort on-click=(action (mut sort))}}
              </span>
              <div class="uk-margin-left">
                <a
                  uk-search-icon
                  uk-toggle="target: [data-toggle-search='identifier-search']; animation: uk-animation-slide-left-small uk-animation-fast"
                  class="uk-toggle"
                  href="#"
                >
                </a>
              </div>
            </div>
            <div class="uk-flex-inline uk-width-1-1 uk-flex-between" data-toggle-search="identifier-search" hidden>
              <input
                autofocus
                class="uk-search-input uk-width-auto uk-padding-remove"
                type="search"
                placeholder="Suchen..."
                value={{identifier}}
                oninput={{action (perform search) value="target.value"}}
              >
              <a
                uk-close
                uk-toggle="target: [data-toggle-search='identifier-search']; animation: uk-animation-slide-right-small uk-animation-fast"
                class="uk-toggle uk-flex-inline uk-flex-middle"
                href="#"
                {{action (mut identifier) ""}}
              >
              </a>
            </div>
          </th>
          <th>
            Gesuchsart
            {{camac-sort-icon key="form__description" sort=sort on-click=(action (mut sort))}}
          </th>
          <th>
            Status
            {{camac-sort-icon key="instance_state__description" sort=sort on-click=(action (mut sort))}}
          </th>
          <th>
            Gemeinde
            {{camac-sort-icon key="location__communal_federal_number" sort=sort on-click=(action (mut sort))}}
          </th>
          <th class="uk-text-right">
            Erstelldatum
            {{camac-sort-icon key="creation_date" sort=sort on-click=(action (mut sort))}}
          </th>
          <th class="uk-width-small"></th>
        </tr>
      </thead>
      <tbody>
        {{#if data.isRunning}}
          <tr>
            <td class="uk-text-center" colspan="5">{{uk-spinner}}</td>
          </tr>
        {{else}}
          {{#each data.lastSuccessful.value as |edge i|}}
            <tr>
              <td>-</td>
              <td>
                {{#link-to
                  "instances.edit" edge.node.id
                  title="Klicken Sie um das Gesuch zu bearbeiten"
                }}
                  {{instance-type edge.node.document}}
                {{/link-to}}
              </td>
              <td>{{t (concat "instance.status." edge.node.status)}}</td>
              <td class="uk-text-nowrap">
                {{get municipalities i}}
              </td>
              <td class="uk-text-right uk-text-nowrap">
                {{format-date edge.node.createdAt}}
              </td>
              <td class="uk-text-center">
                {{!--
                <button
                  class="uk-icon-button confirm-delete-{{edge.node.id}}"
                  title="Gesuch löschen"
                  uk-icon="trash"
                  uk-toggle="target: .confirm-delete-{{edge.node.id}}; animation: uk-animation-slide-bottom uk-animation-fast;"
                ></button>
                <span class="uk-text-danger confirm-delete-{{edge.node.id}}" hidden>
                  Löschen?<br>
                  <button
                    class="uk-icon-button uk-text-danger"
                    uk-icon="check"
                    {{action (perform delete) edge.node on="click" bubbles=false}}
                  ></button>
                  <button
                    class="uk-icon-button uk-text-danger"
                    uk-icon="close"
                    uk-toggle="target: .confirm-delete-{{edge.node.id}}; animation: uk-animation-slide-bottom uk-animation-fast;"
                  ></button>
                </span>--}}
              </td>
            </tr>
          {{^}}
            <tr>
              <td class="uk-text-center" colspan="6">
                <i>Kein Gesuch mit dieser Gesuchsnummer gefunden</i>
              </td>
            </tr>
          {{/each}}
        {{/if}}
        <tr role="link" title="Klicken Sie um ein neues Gesuch zu erstellen" class="pointer" {{action (transition-to "instances.new") on="click"}}>
          <td class="uk-text-center" colspan="6">
            {{uk-icon "plus" scale=2}}
          </td>
        </tr>
      </tbody>
    </table>
  {{else}}
    {{#uk-flex horizontal="center" vertical="middle" direction="column"}}
      <div class="uk-text-center uk-width-large">
        <object data="/assets/images/stamp-document.svg" class="uk-width-medium"></object>
        <h4 class="uk-margin-remove-top">Sie haben noch keine Gesuche!</h4>
        <p>
          Erstellen Sie jetzt schnell und bequem Ihr erstes Gesuch. Sie
          können es jederzeit schliessen und problemlos ein andermal weiter
          ausfüllen.
        </p>
        {{#link-to "instances.new" class="uk-button uk-button-primary uk-button-large"}}Gesuch erstellen{{/link-to}}
      </div>
    {{/uk-flex}}
  {{/if}}
{{else if data.isRunning}}
  {{#uk-flex horizontal="center" class="uk-padding uk-animation-fade"}}
    {{uk-spinner ratio=3}}
  {{/uk-flex}}
{{/if}}

{{log "municipalities" municipalities}}