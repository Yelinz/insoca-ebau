<h1 class="uk-flex uk-flex-between">
  {{t "instances.title"}}
  <span>
    {{#link-to "instances.new" class="uk-button uk-button-secondary"}}{{t "instances.new.title"}}{{/link-to}}
  </span>
</h1>

<form onsubmit={{perform applyFilters}}>
  <div uk-grid class="uk-grid-small uk-margin uk-child-width-1-1 uk-child-width-1-3@l">
    <div>
      <label class="uk-form-label">{{t "instances.type"}}</label>
      <div class="uk-form-controls">
        <select class="uk-select" name="type">
          <option></option>
          {{#each getRootForms.lastSuccessful.value as |form|}}
            <option value={{form.slug}} selected={{eq type form.slug}}>{{form.name}}</option>
          {{/each}}
        </select>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.instanceId"}}</label>
      <div class="uk-form-controls">
        <input type="text" class="uk-input" name="instanceId" value={{instanceId}}>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.ebau"}}</label>
      <div class="uk-form-controls">
        <input type="text" class="uk-input" name="ebau" value={{ebau}}>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.parcel"}}</label>
      <div class="uk-form-controls">
        <input type="text" class="uk-input" name="parcel" value={{parcel}}>
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.submitDate"}}</label>
      <div class="uk-form-controls uk-grid-small uk-child-width-1-2" uk-grid>
        <div>
          {{pikaday-input class="uk-input" name="submitFrom" value=submitFrom useUTC=true}}
        </div>
        <div>
          {{pikaday-input class="uk-input" name="submitTo" value=submitTo useUTC=true}}
        </div>
      </div>
    </div>
    <div class="uk-flex uk-flex-right uk-flex-bottom">
      {{uk-button color="default" type="reset" disabled=fetchData.isRunning label=(t "instances.reset") on-click=(perform resetFilters) class="uk-margin-small-right"}}
      {{uk-button color="primary" type="submit" disabled=fetchData.isRunning label=(t "instances.filter")}}
    </div>
  </div>
</form>

<hr>

{{#if (and fetchData.isRunning (eq documents.length 0))}}
  <div class="uk-text-center uk-padding">
    {{uk-spinner ratio=2}}
  </div>
{{else if documents.length}}
  <div uk-grid>
    <div class="uk-width-expand uk-flex uk-flex-middle uk-text-meta">
      <span>{{t "instances.pageInfo" length=documents.length total=pageInfo.totalCount htmlSafe=true}}</span>
    </div>

    <div class="uk-width-auto uk-flex uk-flex-middle">
      <label class="uk-text-meta uk-text-nowrap">
        {{t "instances.orderBy"}}:
      </label>
      <select class="uk-select uk-form-small uk-margin-small-left" onchange={{action (mut order) value="target.value"}}>
        {{#each orderOptions as |o|}}
          <option value={{o.value}} selected={{eq order o.value}}>{{t o.label}} ({{t o.direction}})</option>
        {{/each}}
      </select>
    </div>
  </div>
  <table class="uk-table uk-table-striped uk-table-hover uk-table-responsive">
    <thead>
      <tr>
        <th class="uk-text-nowrap">{{t "instances.instanceId"}}</th>
        <th class="uk-text-nowrap">{{t "instances.ebau"}}</th>
        <th class="uk-text-nowrap">{{t "instances.type"}}</th>
        <th class="uk-text-nowrap">{{t "instances.municipality"}}</th>
        <th class="uk-text-nowrap">{{t "instances.address"}}</th>
        <th class="uk-text-nowrap">{{t "instances.submitDate"}}</th>
        <th class="uk-text-nowrap">{{t "instances.status.title"}}</th>
        <th class="uk-text-nowrap">{{t "instances.description"}}</th>
      </tr>
    </thead>
    <tbody>
      {{#each documents as |document|}}
        <tr>
          <td>
            {{#link-to "instances.edit" document.instanceId title="Klicken Sie um das Gesuch zu bearbeiten"}}
              {{document.instanceId}}
            {{/link-to}}
          </td>
          <td>{{document.ebau}}</td>
          <td class="uk-text-nowrap">{{document.type}}</td>
          <td>{{document.municipality}}</td>
          <td class="uk-text-truncate" title={{document.address}}>{{document.address}}</td>
          <td>{{if document.submitDate (moment-format document.submitDate "DD.MM.YYYY")}}</td>
          <td>{{document.status}}</td>
          <td class="uk-text-truncate" title={{document.description}}>{{document.description}}</td>
        </tr>
      {{/each}}
      {{#if pageInfo.hasNextPage}}
        <tr>
          <td colspan="8" class="uk-text-center">
            {{#in-viewport onEnter=(perform fetchData pageInfo.endCursor)}}
              {{uk-spinner}}
            {{/in-viewport}}
          </td>
        </tr>
      {{/if}}
    </tbody>
  </table>
{{else}}
  {{#uk-flex horizontal="center" vertical="middle" direction="column"}}
    <div class="uk-text-center uk-width-large">
      <object data="/assets/images/stamp-document.svg" class="uk-width-medium"></object>
      <h4 class="uk-margin-remove-top">{{t "instances.emptyTitle"}}</h4>
      <p>{{t "instances.emptyText"}}</p>
      {{#link-to "instances.new" class="uk-button uk-button-primary uk-button-large"}}{{t "instances.new.title"}}{{/link-to}}
    </div>
  {{/uk-flex}}
{{/if}}