<Notifications />

<div class="workitemlist-filters">
  <div>
    <div>{{t "workItemList.responsible"}}</div>
    <div class="filters-wrapper">
      <input {{on "click" (fn this.updateFilter "responsible" "all")}} value="all" checked={{eq this.responsible "all"}} type="radio" class="filter-button" name="verantwortlich" id="filter-all"/>
      <label for="filter-all">{{t "workItemList.all.filter.all"}}</label>
      <input {{on "click" (fn this.updateFilter "responsible" "own")}} value="own" checked={{eq this.responsible "own"}} type="radio" class="filter-button" name="verantwortlich" id="filter-own"/>
      <label for="filter-own">{{t "workItemList.all.filter.own"}}</label>
    </div>
  </div>
  <div>
    <div>{{t "workItemList.all.filter.type"}}</div>
    <div class="filters-wrapper">
      <input {{on "click" (fn this.updateFilter "type" "all")}} value="all" checked={{eq this.type "all"}} type="radio" class="filter-button" name="type" id="filter-type-all"/>
      <label for="filter-type-all">{{t "workItemList.all.filter.all"}}</label>
      <input {{on "click" (fn this.updateFilter "type" "new")}} value="new" checked={{eq this.type "new"}} type="radio" class="filter-button" name="type" id="filter-type-new"/>
      <label for="filter-type-new">{{t "workItemList.all.filter.new"}}</label>
    </div>
  </div>
  <div>
    <div>{{t "workItemList.all.filter.status"}}</div>
    <div class="filters-wrapper">
      <input {{on "click" (fn this.updateFilter "status" "open")}} value="open" checked={{eq this.status "open"}} type="radio" class="filter-button" name="status" id="filter-open"/>
      <label for="filter-open">{{t "workItemList.all.filter.open"}}</label>
      <input {{on "click" (fn this.updateFilter "status" "closed")}} value="closed" checked={{eq this.status "closed"}} type="radio" class="filter-button" name="status" id="filter-closed"/>
      <label for="filter-closed">{{t "workItemList.all.filter.closed"}}</label>
    </div>
  </div>
  <div>
    <div>{{t "workItemList.all.filter.role"}}</div>
    <div class="filters-wrapper">
      <input {{on "click" (fn this.updateFilter "role" "active")}} value="active" checked={{eq this.role "active"}} type="radio" class="filter-button" name="role" id="filter-active"/>
      <label for="filter-active">{{t "workItemList.all.filter.active"}}</label>
      <input {{on "click" (fn this.updateFilter "role" "control")}} value="control" checked={{eq this.role "control"}} type="radio" class="filter-button" name="role" id="filter-control"/>
      <label for="filter-control">{{t "workItemList.all.filter.control"}}</label>
    </div>
  </div>
</div>

<table {{did-insert (perform this.fetchWorkItems)}}>
  <thead>
    <tr>
      <th>{{t "workItemList.all.table.instance"}}</th>
      <th>{{t "workItemList.all.table.instanceType"}}</th>
      <th>{{t "workItemList.task"}}</th>
      <th>{{t "workItemList.deadline"}}</th>
      <th>{{t "workItemList.created"}}</th>
      <th>{{t "workItemList.responsible"}}</th>
      {{#if (eq this.role "control")}}
        <th>{{t "workItemList.addressedGroups"}}</th>
      {{/if}}
      <th></th>
    </tr>
  </thead>
  <tbody>
    {{#if (and this.workItemsQuery.isLoading (not this.workItemsQuery.value.length))}}
      <tr>
        <td class="center" colspan="{{if (eq this.role "control") 8 7}}"><LoadingText /></td>
      </tr>
    {{else}}
      {{#each this.workItemsQuery.value as |workItem|}}
        <tr class="workitem {{workItem.workItemColor}}">
          <td><a href="{{workItem.instanceLink}}">{{workItem.instanceIdentifier}}</a></td>
          <td>{{workItem.instanceName}}</td>
          <td><LinkTo @route="work-items.instance.edit" @models={{array workItem.instance workItem}}>{{workItem.name}}</LinkTo></td>
          <td>{{moment-from workItem.deadline}}</td>
          <td>
            {{format-date
              workItem.createdAt
              day="2-digit"
              month="2-digit"
              year="numeric"
              hour="2-digit"
              minute="2-digit"
              hour12=false
            }}
          </td>
          <td>
            {{#each workItem.assignedUserInformation as |user|}}
              {{user.fullName}}
            {{else}}
              -
            {{/each}}
          </td>
          {{#if (eq this.role "control")}}
            <td>
              {{#each workItem.addressedServices as |service|}}
                {{service.name}}
              {{else}}
                -
              {{/each}}
            </td>
          {{/if}}
          <td {{on "mouseleave" (set this.menuOpen "")}} role="button">
            <div>
              <FaIcon @icon="ellipsis-v" {{on "click" (set this.menuOpen workItem.id)}}/>
              {{#if (eq this.menuOpen workItem.id)}}
                <div class="workitem-actions">
                  {{!-- template-lint-disable no-nested-interactive --}}
                  <ul>
                    {{#if workItem.meta.not-viewed}}
                      <li {{on "click" (perform this.workItemRead workItem)}} role="button">{{t "workItemList.all.table.markRead"}}</li>
                    {{/if}}
                    {{#if (not (contains this.userId workItem.assignedUsers))}}
                      <li {{on "click" (perform this.workItemAssignUser workItem)}} role="button">{{t "workItemList.all.table.assignToMe"}}</li>
                    {{/if}}
                    {{!-- TODO: link to edit workitem view after its created --}}
                    <li role="button">{{t "workItemList.all.table.editWorkitem"}}</li>
                  </ul>
                </div>
              {{/if}}
            </div>
          </td>
        </tr>
      {{else}}
        <tr>
          <td class="center" colspan="{{if (eq this.role "control") 8 7}}">{{t "workItemList.empty"}}</td>
        </tr>
      {{/each}}
      {{#if (or this.workItemsQuery.hasNextPage this.workItemsQuery.isLoading)}}
        <tr>
          <td class="center" colspan="{{if (eq this.role "control") 8 7}}">
            {{#if this.workItemsQuery.isLoading}}
              <LoadingText />
            {{else}}
              <a href="" {{on "click" (perform this.fetchMoreWorkItems)}}>{{t "workItemList.all.table.loadMore"}}</a>
            {{/if}}
          </td>
        </tr>
      {{/if}}
    {{/if}}
  </tbody>
</table>
