FROM projectcaluma/caluma:version-3.0.0

ENV VISIBILITY_CLASSES caluma.extensions.visibilities.CustomVisibility
ENV PERMISSION_CLASSES caluma.extensions.permissions.CustomPermission
ENV VALIDATION_CLASSES caluma.extensions.validations.CustomValidation
ENV DATA_SOURCE_CLASSES caluma.extensions.data_sources.Municipalities,caluma.extensions.data_sources.Services

ENV LANGUAGE_CODE de
ENV LANGUAGES de,fr
ENV OIDC_BEARER_TOKEN_REVALIDATION_TIME 300
ENV META_FIELDS camac-instance-id,ebau-number,submit-date
ENV ENABLE_HISTORICAL_API true

COPY extensions /app/caluma/extensions
COPY fixtures /app/caluma/fixtures

CMD /bin/sh -c "wait-for-it.sh $DATABASE_HOST:${DATABASE_PORT:-5432} -- ./manage.py migrate && ./manage.py loaddata caluma/fixtures/config.json && uwsgi"
